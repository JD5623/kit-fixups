--- pam-1.3.0-r3.ebuild	2018-10-24 21:23:16.380025000 -0600
+++ pam-1.3.0-r4.ebuild	2018-10-24 21:23:16.380025000 -0600
@@ -1,8 +1,8 @@
 # Distributed under the terms of the GNU General Public License v2
 
-EAPI="5"
+EAPI=5
 
-inherit libtool multilib multilib-minimal eutils pam toolchain-funcs flag-o-matic db-use fcaps
+inherit autotools libtool multilib multilib-minimal eutils pam toolchain-funcs flag-o-matic db-use fcaps
 
 MY_PN="Linux-PAM"
 MY_P="${MY_PN}-${PV}"
@@ -14,7 +14,7 @@
 
 LICENSE="|| ( BSD GPL-2 )"
 SLOT="0"
-KEYWORDS="~alpha ~amd64 ~arm ~arm64 ~hppa ~ia64 ~m68k ~mips ~ppc ~ppc64 ~s390 ~sh ~sparc ~x86 ~amd64-linux ~x86-linux"
+KEYWORDS=""
 IUSE="audit berkdb +cracklib debug nis nls +pie selinux test vim-syntax"
 
 RDEPEND="
@@ -30,7 +30,8 @@
 	>=sys-devel/libtool-2
 	>=sys-devel/flex-2.5.39-r1[${MULTILIB_USEDEP}]
 	nls? ( sys-devel/gettext )
-	nis? ( >=virtual/pkgconfig-0-r1[${MULTILIB_USEDEP}] )"
+	nis? ( >=virtual/pkgconfig-0-r1[${MULTILIB_USEDEP}] )
+	dev-libs/libxslt"
 
 PDEPEND="
 	sys-auth/pambase
@@ -92,7 +93,8 @@
 	sed -i \
 		-e '/ test /s:==:=:' \
 		configure || die
-	elibtoolize
+	epatch "${FILESDIR}"/${P}-faillock.patch # faillock support from Red Hat.
+	eautoreconf
 }
 
 multilib_src_configure() {
@@ -128,6 +130,7 @@
 }
 
 multilib_src_compile() {
+	emake -C "${S}/modules/pam_faillock" -f "${BUILD_DIR}/modules/pam_faillock/Makefile" -f "${S}/Make.xml.rules" faillock.8 pam_faillock.8
 	emake sepermitlockdir="${EPREFIX}/run/sepermit"
 }
 
@@ -155,12 +158,16 @@
 DOCS=( CHANGELOG ChangeLog README AUTHORS Copyright NEWS )
 
 multilib_src_install_all() {
+	# faillock binary requires logging directory. We will use /var/log/faillock.
+	keepdir /var/log/faillock
+
 	einstalldocs
 	prune_libtool_files --all
 
 	docinto modules
 	local dir
 	for dir in modules/pam_*; do
+		[[ ${dir} == modules/pam_faillock ]] && continue #  README build excluded due || ( virtual/w3m www-client/links ) DEPEND requirement. not good for stage1/2/3.
 		newdoc "${dir}"/README README."$(basename "${dir}")"
 	done
 
